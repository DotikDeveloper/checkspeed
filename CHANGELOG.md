# Changelog

## 1.3.0 — 24.11.2025

- **критическое исправление алгоритмов измерения скорости**: переработаны функции `testDownloadSpeed()`, `testUploadSpeed()` и `testPing()` для корректного учёта времени передачи данных;
- **download**: теперь измеряется время от начала запроса до завершения передачи (включая TTFB - Time To First Byte), что устраняет завышенные результаты на localhost;
- **upload**: улучшена точность измерения через корректную обработку событий `loadstart`/`loadend` и добавлен мониторинг прогресса передачи;
- **ping**: добавлена валидация результатов и улучшена обработка измерений;
- **логирование в продакшене**: логирование автоматически включается на localhost и может быть активировано в production через параметры;
- **валидация результатов**: добавлена проверка на нереалистично высокие значения скорости (>100 Гбит/с) и пинга (>10 секунд) с предупреждениями в логах;
- **обновлены тесты**: все unit-тесты переписаны с учётом новой логики измерения времени и добавлено мокирование logger;
- **детальное логирование**: логируются время начала/окончания замеров, промежуточные результаты, TTFB, ошибки и параметры сетевого соединения.

## 1.2.6 — 24.11.2025

- добавлен пул предсозданных буферов `BufferPool` (`src/app/api/utils/buffer-pool.ts`) для повторного использования буферов разных размеров (0.5, 1, 2, 5, 10 МБ) с ограничением пула до 10 буферов на размер;
- эндпоинт `/api/download` переведён на использование `BufferPool`, что уменьшает количество аллокаций `Buffer.alloc` под нагрузкой.

## 1.2.5 — 24.11.2025

- настроен Vitest с окружением jsdom и генерацией покрытия (`vitest.config.ts`), добавлены dev-зависимости `jsdom` и `@vitest/coverage-v8`;
- реализованы детализированные unit-тесты для `testDownloadSpeed()`, `testUploadSpeed()` и `testPing()` с моками `fetch`/`XMLHttpRequest`/`performance.now`, проверкой расчётов и путей ошибок;
- добавлены проверки покрытия (`vitest run --coverage` показывает 91.5% по `src/utils`) и чек-лист в `docs/improvements/04-GITHUB-TASKS.md`.

## 1.2.4 — 20.11.2025

- создан модуль статистики `src/utils/stats.ts` с функциями `average()`, `median()`, `removeOutliers()` и `averageWithoutColdStart()`;
- интегрирована статистическая обработка во все функции измерения (download, upload, ping) с автоматическим удалением выбросов;
- добавлены unit-тесты для всех функций статистики (26 тестов);
- рефакторинг: статистические функции вынесены в отдельный модуль для переиспользования.

## 1.2.3 — 20.11.2025

- исправлен расчёт ping: измерения выполняются 10 раз с использованием `performance.now()`, отбрасываются первое и последнее значения, результат берётся по медиане;
- добавлен специализированный эндпоинт `/api/ping` с лёгким ответом для ускорения запросов;
- удалён неиспользуемый код и добавлены unit-тесты для функции `median`.

## 1.2.2 — 20.11.2025

- ограничен максимальный размер тестовых файлов до 3 МБ как на клиенте, так и на `/api/upload`, чтобы избежать 413 на Vercel и укладываться в лимиты serverless-функций;
- скорректирован список размеров в прогрессивном тестировании upload: теперь берём 0.5–3 МБ.

## 1.2.1 — 20.11.2025

- переработана функция измерения upload-скорости: использование XMLHttpRequest с событиями `loadstart`/`loadend` для точного замера времени передачи без накладных расходов;
- реализовано прогрессивное тестирование upload с размерами файлов 0.5–10 МБ и множественными измерениями (3 на каждый размер) с отбрасыванием cold start;
- эндпоинт `/api/upload` теперь читает поток данных через Streams API, валидирует размер до 10 МБ и возвращает фактически полученный объём;
- добавлена утилита `createUploadPayload()` с unit-тестами; исправлена совместимость типов для XMLHttpRequest.send().

## 1.2.0 — 20.11.2025

- переработана функция измерения download-скорости: потоковое чтение через Streams API, последовательные размеры файлов 0.5–10 МБ и усреднение без cold start;
- эндпоинт `/api/download` принимает параметр `size`, нормализует объём и исключает кэширование;
- добавлены утилиты `bytesToMbps` и `averageWithoutColdStart` с покрытием unit-тестами на Vitest; документация дополнена инструкцией по запуску тестов.

## 1.1.0 — 12.11.2025

- обновлены ключевые зависимости: Next.js 16, React 19.2, TypeScript 5.9, ESLint 9, Tailwind CSS 3.4.18;
- настроен flat-config ESLint (`eslint.config.mjs`) и скрипт `npm run lint`;
- переработана логика измерения скорости с использованием `startTransition`, чтобы избежать каскадных ререндеров;
- добавлены серии измерений, графики динамики и вычисление средних значений по результатам тестов;
- актуализированы инструкции в `README.md`, добавлен раздел про деплой на Vercel и версионирование;
- исправлен `tsconfig.json`, удалены ошибочные пути, добавлена поддержка `.next/dev/types`.

## 1.0.0 — релиз

- начальная версия приложения с измерением скорости загрузки, отдачи и ping;
- поддержка запуска через Next.js и Docker.
